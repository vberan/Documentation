Stored Procedure Stage.uspLoadCERTdboOrders {#spStageuspLoadCERTdboOrders}
-------------------------------------------

Definition of Stored procedure:

``` {.sql}
CREATE PROCEDURE [Stage].[uspLoadCERTdboOrders] 
    @ThreadLogId int
        , @DataSourceId int
    AS
    BEGIN TRY
        -- set up the enviroment
        SET NOCOUNT ON;
    

        TRUNCATE TABLE [Stage].[CERTdboOrders]; 

        -- log the initial table state
        UPDATE Etl.ThreadLog
            SET TableInitialRowCount = (SELECT COUNT(*) FROM [Stage].[CERTdboOrders] WITH (NOLOCK))
        WHERE ThreadLogId = @ThreadLogId;

        DECLARE @loadDateFrom datetime2;
        SELECT @loadDateFrom = '1901-01-01';

        INSERT INTO [Stage].[CERTdboOrders]
            ( 
                [AccrualsDescrDIS]
                , [AccrualsDIS]
                , [ActualDealerDate]
                , [AdvancePayment]
                , [BodyCategory]
                , [BodyColour]
                , [BodyInvDate]
                , [BodyPrice]
                , [BodyReInvoiceNr]
                , [BodyReivoicingDate]
                , [BodyWarantyMonthNr]
                , [BodyWorkDescription]
                , [CancelationMoment]
                , [CanceledDealsHistory]
                , [CASTspecifPackage]
                , [CDD2]
                , [ConfirmedDelDealerDate]
                , [ContractedInOrder]
                , [ContractNumber]
                , [Country]
                , [CountryToCountryBodyPrice]
                , [CountryToCountryInvoiceDay]
                , [CountryToCountryInvoiceNr]
                , [CountryToCountryInvoicePrice]
                , [CountryToCountryInvoiceRequestSendDate]
                , [CountryToCountryInvoiceWay]
                , [CreditAmount]
                , [CreditDate]
                , [CreditNr]
                , [CTC_HandOverProtocol]
                , [CTC_InvoCust]
                , [CTC_InvoiceRequest]
                , [CustomerListPrice]
                , [CustomerPriceForecast]
                , [CustomerPriceInvoicedCZK]
                , [CustomerPriceInvoicedEUR]
                , [DamageDescFromCMR]
                , [DateOUT]
                , [DealerCostForecast]
                , [DealerCostInvoicedCZK]
                , [DealerCostInvoicedEUR]
                , [DealerFond]
                , [DealerMarginScalaCZK]
                , [DealerMarginScalaEUR]
                , [DealRefNu]
                , [DeliveryAddressFull]
                , [DeliveryCustomerDate]
                , [DeliveryDealerDate]
                , [DeliveryEndCustDate]
                , [DepositAmount]
                , [DepositDate]
                , [DepositNr]
                , [DlrPriceChecked]
                , [DXF]
                , [EngineNumber]
                , [EPC_lenght]
                , [ExchRateAtDCD]
                , [ExwExtraDiscount]
                , [ExwFleetDiscount]
                , [ExwInvDate]
                , [EXWListPriceForecast]
                , [ExworksInvoiceNu]
                , [ExworksListPrice]
                , [ExworksPrice]
                , [ExwPriceOKYesNo]
                , [ExwSurcharge]
                , [EXWsurchargeForecast]
                , [FleetSupportRequest]
                , [FleetSuppSVASamount]
                , [FleetSuppSVASdescript]
                , [FromBodybuilderDelDate]
                , [FuelLevelFromCMR]
                , [HighServiceLevel]
                , [ChassisNumber]
                , [ChassisType]
                , [ChassisWeight]
                , [ID_Application]
                , [ID_Bodybuilder]
                , [ID_BodyPriceCurrency]
                , [ID_BodySegment]
                , [ID_Campaign]
                , [ID_CurrentTruckLocation]
                , [ID_Customer]
                , [ID_Destinace]
                , [ID_EcolutionAnalyse]
                , [ID_ImporterDiscounCode]
                , [ID_InvoiceOwnerCntry]
                , [ID_LeasingCompany]
                , [ID_LeasingCurrency]
                , [ID_OldStatus]
                , [ID_Operations]
                , [ID_PPS]
                , [ID_PrevReservSman]
                , [ID_PuvodniCustomer]
                , [ID_PuvodniUser]
                , [ID_ReservationUser]
                , [ID_ServiceContract]
                , [ID_ServiceContrAmountCurr]
                , [ID_Status]
                , [ID_TPrequester]
                , [ID_User]
                , [ID_userWhoMovedPDD]
                , [IDD]
                , [ImpDiscount]
                , [ImporterCosts]
                , [ImporterInvPrice]
                , [ImporterListPrice]
                , [ImporterPrice]
                , [IntrastatDate]
                , [InvoiceRqSend]
                , [InvToCustDate]
                , [LastAddressChange]
                , [LeasingConfirmDate]
                , [OLAF]
                , [OrderSendDate]
                , [OriginalPromisedDeliveryDate]
                , [OurOrderNu]
                , [OvertakenBy]
                , [OvertakingDate]
                , [PicturesAvailable]
                , [PreviousPromisedDeliveryDate]
                , [PreviousReservTill]
                , [PreviousSalesDate]
                , [ProdPeriod]
                , [Prodplant]
                , [PromisedDeliveryDate]
                , [Remark]
                , [RemarkInsurence]
                , [ReservationRemark]
                , [ReservationSince]
                , [ReservationTill]
                , [RVG_amount]
                , [RVG_approved]
                , [RVG_BuyBackDate]
                , [RVG_contracted]
                , [RVG_Currency]
                , [RVG_maxOdometer]
                , [SaleableRENT]
                , [SalesContractNr]
                , [SalesDate]
                , [ScaniaOrderNu]
                , [Selector]
                , [ServiceContrAmount]
                , [ServiceContrPaidFrMrg]
                , [SpecifDefiniteDate]
                , [SPZ]
                , [StartOfWarrantyDate]
                , [StatusChangeDate]
                , [STOCKRemark]
                , [SupportDoFabriky]
                , [ToBodybuilderDelDate]
                , [TotalCredit]
                , [TPreqDate]
                , [TPreqRemark]
                , [TPtakingOver]
                , [TruckLocationChangeDate]
                , [TruckLocationChangeHistory]
                , [Used]
                , [VATreference]
                , [VehicleLocation]
                , [VersionCesowOrderID]
                , [VIN]
                , [ZachovatCenu]
                , [ZTPnumber]
                , [DataSourceId]
                , [ThreadLogId]
    )

        SELECT 
                [AccrualsDescrDIS] = s.[AccrualsDescrDIS]
                , [AccrualsDIS] = s.[AccrualsDIS]
                , [ActualDealerDate] = s.[ActualDealerDate]
                , [AdvancePayment] = s.[AdvancePayment]
                , [BodyCategory] = s.[BodyCategory]
                , [BodyColour] = s.[BodyColour]
                , [BodyInvDate] = s.[BodyInvDate]
                , [BodyPrice] = s.[BodyPrice]
                , [BodyReInvoiceNr] = s.[BodyReInvoiceNr]
                , [BodyReivoicingDate] = s.[BodyReivoicingDate]
                , [BodyWarantyMonthNr] = s.[BodyWarantyMonthNr]
                , [BodyWorkDescription] = s.[BodyWorkDescription]
                , [CancelationMoment] = s.[CancelationMoment]
                , [CanceledDealsHistory] = s.[CanceledDealsHistory]
                , [CASTspecifPackage] = s.[CASTspecifPackage]
                , [CDD2] = s.[CDD2]
                , [ConfirmedDelDealerDate] = s.[ConfirmedDelDealerDate]
                , [ContractedInOrder] = s.[ContractedInOrder]
                , [ContractNumber] = s.[ContractNumber]
                , [Country] = s.[Country]
                , [CountryToCountryBodyPrice] = s.[CountryToCountryBodyPrice]
                , [CountryToCountryInvoiceDay] = s.[CountryToCountryInvoiceDay]
                , [CountryToCountryInvoiceNr] = s.[CountryToCountryInvoiceNr]
                , [CountryToCountryInvoicePrice] = s.[CountryToCountryInvoicePrice]
                , [CountryToCountryInvoiceRequestSendDate] = s.[CountryToCountryInvoiceRequestSendDate]
                , [CountryToCountryInvoiceWay] = s.[CountryToCountryInvoiceWay]
                , [CreditAmount] = s.[CreditAmount]
                , [CreditDate] = s.[CreditDate]
                , [CreditNr] = s.[CreditNr]
                , [CTC_HandOverProtocol] = s.[CTC_HandOverProtocol]
                , [CTC_InvoCust] = s.[CTC_InvoCust]
                , [CTC_InvoiceRequest] = s.[CTC_InvoiceRequest]
                , [CustomerListPrice] = s.[CustomerListPrice]
                , [CustomerPriceForecast] = s.[CustomerPriceForecast]
                , [CustomerPriceInvoicedCZK] = s.[CustomerPriceInvoicedCZK]
                , [CustomerPriceInvoicedEUR] = s.[CustomerPriceInvoicedEUR]
                , [DamageDescFromCMR] = s.[DamageDescFromCMR]
                , [DateOUT] = s.[DateOUT]
                , [DealerCostForecast] = s.[DealerCostForecast]
                , [DealerCostInvoicedCZK] = s.[DealerCostInvoicedCZK]
                , [DealerCostInvoicedEUR] = s.[DealerCostInvoicedEUR]
                , [DealerFond] = s.[DealerFond]
                , [DealerMarginScalaCZK] = s.[DealerMarginScalaCZK]
                , [DealerMarginScalaEUR] = s.[DealerMarginScalaEUR]
                , [DealRefNu] = s.[DealRefNu]
                , [DeliveryAddressFull] = s.[DeliveryAddressFull]
                , [DeliveryCustomerDate] = s.[DeliveryCustomerDate]
                , [DeliveryDealerDate] = s.[DeliveryDealerDate]
                , [DeliveryEndCustDate] = s.[DeliveryEndCustDate]
                , [DepositAmount] = s.[DepositAmount]
                , [DepositDate] = s.[DepositDate]
                , [DepositNr] = s.[DepositNr]
                , [DlrPriceChecked] = s.[DlrPriceChecked]
                , [DXF] = s.[DXF]
                , [EngineNumber] = s.[EngineNumber]
                , [EPC_lenght] = s.[EPC_lenght]
                , [ExchRateAtDCD] = s.[ExchRateAtDCD]
                , [ExwExtraDiscount] = s.[ExwExtraDiscount]
                , [ExwFleetDiscount] = s.[ExwFleetDiscount]
                , [ExwInvDate] = s.[ExwInvDate]
                , [EXWListPriceForecast] = s.[EXWListPriceForecast]
                , [ExworksInvoiceNu] = s.[ExworksInvoiceNu]
                , [ExworksListPrice] = s.[ExworksListPrice]
                , [ExworksPrice] = s.[ExworksPrice]
                , [ExwPriceOKYesNo] = s.[ExwPriceOKYesNo]
                , [ExwSurcharge] = s.[ExwSurcharge]
                , [EXWsurchargeForecast] = s.[EXWsurchargeForecast]
                , [FleetSupportRequest] = s.[FleetSupportRequest]
                , [FleetSuppSVASamount] = s.[FleetSuppSVASamount]
                , [FleetSuppSVASdescript] = s.[FleetSuppSVASdescript]
                , [FromBodybuilderDelDate] = s.[FromBodybuilderDelDate]
                , [FuelLevelFromCMR] = s.[FuelLevelFromCMR]
                , [HighServiceLevel] = s.[HighServiceLevel]
                , [ChassisNumber] = s.[ChassisNumber]
                , [ChassisType] = s.[ChassisType]
                , [ChassisWeight] = s.[ChassisWeight]
                , [ID_Application] = s.[ID_Application]
                , [ID_Bodybuilder] = s.[ID_Bodybuilder]
                , [ID_BodyPriceCurrency] = s.[ID_BodyPriceCurrency]
                , [ID_BodySegment] = s.[ID_BodySegment]
                , [ID_Campaign] = s.[ID_Campaign]
                , [ID_CurrentTruckLocation] = s.[ID_CurrentTruckLocation]
                , [ID_Customer] = s.[ID_Customer]
                , [ID_Destinace] = s.[ID_Destinace]
                , [ID_EcolutionAnalyse] = s.[ID_EcolutionAnalyse]
                , [ID_ImporterDiscounCode] = s.[ID_ImporterDiscounCode]
                , [ID_InvoiceOwnerCntry] = s.[ID_InvoiceOwnerCntry]
                , [ID_LeasingCompany] = s.[ID_LeasingCompany]
                , [ID_LeasingCurrency] = s.[ID_LeasingCurrency]
                , [ID_OldStatus] = s.[ID_OldStatus]
                , [ID_Operations] = s.[ID_Operations]
                , [ID_PPS] = s.[ID_PPS]
                , [ID_PrevReservSman] = s.[ID_PrevReservSman]
                , [ID_PuvodniCustomer] = s.[ID_PuvodniCustomer]
                , [ID_PuvodniUser] = s.[ID_PuvodniUser]
                , [ID_ReservationUser] = s.[ID_ReservationUser]
                , [ID_ServiceContract] = s.[ID_ServiceContract]
                , [ID_ServiceContrAmountCurr] = s.[ID_ServiceContrAmountCurr]
                , [ID_Status] = s.[ID_Status]
                , [ID_TPrequester] = s.[ID_TPrequester]
                , [ID_User] = s.[ID_User]
                , [ID_userWhoMovedPDD] = s.[ID_userWhoMovedPDD]
                , [IDD] = s.[IDD]
                , [ImpDiscount] = s.[ImpDiscount]
                , [ImporterCosts] = s.[ImporterCosts]
                , [ImporterInvPrice] = s.[ImporterInvPrice]
                , [ImporterListPrice] = s.[ImporterListPrice]
                , [ImporterPrice] = s.[ImporterPrice]
                , [IntrastatDate] = s.[IntrastatDate]
                , [InvoiceRqSend] = s.[InvoiceRqSend]
                , [InvToCustDate] = s.[InvToCustDate]
                , [LastAddressChange] = s.[LastAddressChange]
                , [LeasingConfirmDate] = s.[LeasingConfirmDate]
                , [OLAF] = s.[OLAF]
                , [OrderSendDate] = s.[OrderSendDate]
                , [OriginalPromisedDeliveryDate] = s.[OriginalPromisedDeliveryDate]
                , [OurOrderNu] = s.[OurOrderNu]
                , [OvertakenBy] = s.[OvertakenBy]
                , [OvertakingDate] = s.[OvertakingDate]
                , [PicturesAvailable] = s.[PicturesAvailable]
                , [PreviousPromisedDeliveryDate] = s.[PreviousPromisedDeliveryDate]
                , [PreviousReservTill] = s.[PreviousReservTill]
                , [PreviousSalesDate] = s.[PreviousSalesDate]
                , [ProdPeriod] = s.[ProdPeriod]
                , [Prodplant] = s.[Prodplant]
                , [PromisedDeliveryDate] = s.[PromisedDeliveryDate]
                , [Remark] = s.[Remark]
                , [RemarkInsurence] = s.[RemarkInsurence]
                , [ReservationRemark] = s.[ReservationRemark]
                , [ReservationSince] = s.[ReservationSince]
                , [ReservationTill] = s.[ReservationTill]
                , [RVG_amount] = s.[RVG_amount]
                , [RVG_approved] = s.[RVG_approved]
                , [RVG_BuyBackDate] = s.[RVG_BuyBackDate]
                , [RVG_contracted] = s.[RVG_contracted]
                , [RVG_Currency] = s.[RVG_Currency]
                , [RVG_maxOdometer] = s.[RVG_maxOdometer]
                , [SaleableRENT] = s.[SaleableRENT]
                , [SalesContractNr] = s.[SalesContractNr]
                , [SalesDate] = s.[SalesDate]
                , [ScaniaOrderNu] = s.[ScaniaOrderNu]
                , [Selector] = s.[Selector]
                , [ServiceContrAmount] = s.[ServiceContrAmount]
                , [ServiceContrPaidFrMrg] = s.[ServiceContrPaidFrMrg]
                , [SpecifDefiniteDate] = s.[SpecifDefiniteDate]
                , [SPZ] = s.[SPZ]
                , [StartOfWarrantyDate] = s.[StartOfWarrantyDate]
                , [StatusChangeDate] = s.[StatusChangeDate]
                , [STOCKRemark] = s.[STOCKRemark]
                , [SupportDoFabriky] = s.[SupportDoFabriky]
                , [ToBodybuilderDelDate] = s.[ToBodybuilderDelDate]
                , [TotalCredit] = s.[TotalCredit]
                , [TPreqDate] = s.[TPreqDate]
                , [TPreqRemark] = s.[TPreqRemark]
                , [TPtakingOver] = s.[TPtakingOver]
                , [TruckLocationChangeDate] = s.[TruckLocationChangeDate]
                , [TruckLocationChangeHistory] = s.[TruckLocationChangeHistory]
                , [Used] = s.[Used]
                , [VATreference] = s.[VATreference]
                , [VehicleLocation] = s.[VehicleLocation]
                , [VersionCesowOrderID] = s.[VersionCesowOrderID]
                , [VIN] = s.[VIN]
                , [ZachovatCenu] = s.[ZachovatCenu]
                , [ZTPnumber] = s.[ZTPnumber]
                , [DataSourceId] = @DataSourceId
                , [ThreadLogId] = @ThreadLogId
    
        FROM [CERTST10].[CERT].[dbo].[Orders] AS s WITH (NOLOCK)

        --Log ThreadLog Success
        UPDATE Etl.ThreadLog
        SET ExtractRowCount = (SELECT COUNT(*) FROM [Stage].[CERTdboOrders] WITH (NOLOCK) WHERE ThreadLogId = @ThreadLogId)
            , InsertRowCount = (SELECT COUNT(*) FROM [Stage].[CERTdboOrders] WITH (NOLOCK) WHERE ThreadLogId = @ThreadLogId)
            , TableFinalRowCount = (SELECT COUNT(*) FROM [Stage].[CERTdboOrders] WITH (NOLOCK) )
            , EndTime = GETDATE()
            , LoadDateFrom = @loadDateFrom
            , LoadDateTo = GETDATE()
            , StatusId = 3
        WHERE ThreadLogId = @ThreadLogId;

        END TRY

        BEGIN CATCH
            EXEC [dbo].[uspErrorHandler] @ThreadLogId = @ThreadLogId;
        END CATCH
            
        RETURN;
```

\[Back to stored procedure list\]\[listofprocedures\]
