Stored Procedure Stage.uspLoadCRMdboBusinessunit {#spStageuspLoadCRMdboBusinessunit}
------------------------------------------------

Definition of Stored procedure:

``` {.sql}
CREATE PROCEDURE [Stage].[uspLoadCRMdboBusinessunit] 
    @ThreadLogId int
        , @DataSourceId int
    AS
    BEGIN TRY
        -- set up the enviroment
        SET NOCOUNT ON;
    

        TRUNCATE TABLE [Stage].[CRMdboBusinessunit]; 

        -- log the initial table state
        UPDATE Etl.ThreadLog
            SET TableInitialRowCount = (SELECT COUNT(*) FROM [Stage].[CRMdboBusinessunit] WITH (NOLOCK))
        WHERE ThreadLogId = @ThreadLogId;

        DECLARE @loadDateFrom datetime2;
        SELECT @loadDateFrom = '1901-01-01';

        INSERT INTO [Stage].[CRMdboBusinessunit]
            ( 
                [address1_addressid]
                , [address1_addresstypecode]
                , [address1_city]
                , [address1_country]
                , [address1_county]
                , [address1_fax]
                , [address1_latitude]
                , [address1_line1]
                , [address1_line2]
                , [address1_line3]
                , [address1_longitude]
                , [address1_name]
                , [address1_postalcode]
                , [address1_postofficebox]
                , [address1_shippingmethodcode]
                , [address1_stateorprovince]
                , [address1_telephone1]
                , [address1_telephone2]
                , [address1_telephone3]
                , [address1_upszone]
                , [address1_utcoffset]
                , [address2_addressid]
                , [address2_addresstypecode]
                , [address2_city]
                , [address2_country]
                , [address2_county]
                , [address2_fax]
                , [address2_latitude]
                , [address2_line1]
                , [address2_line2]
                , [address2_line3]
                , [address2_longitude]
                , [address2_name]
                , [address2_postalcode]
                , [address2_postofficebox]
                , [address2_shippingmethodcode]
                , [address2_stateorprovince]
                , [address2_telephone1]
                , [address2_telephone2]
                , [address2_telephone3]
                , [address2_upszone]
                , [address2_utcoffset]
                , [businessunitid]
                , [calendarid]
                , [calendarid_entitytype]
                , [costcenter]
                , [createdby]
                , [createdby_entitytype]
                , [createdbyname]
                , [createdbyyominame]
                , [createdon]
                , [createdonbehalfby]
                , [createdonbehalfby_entitytype]
                , [createdonbehalfbyname]
                , [createdonbehalfbyyominame]
                , [creditlimit]
                , [description]
                , [disabledreason]
                , [divisionname]
                , [emailaddress]
                , [exchangerate]
                , [fileasname]
                , [ftpsiteurl]
                , [Id]
                , [importsequencenumber]
                , [inheritancemask]
                , [isdisabled]
                , [llp_countryid]
                , [llp_countryid_entitytype]
                , [llp_countryidname]
                , [llp_iddealernr]
                , [llp_idnetsuite]
                , [llp_isworkshop]
                , [llp_teamid]
                , [llp_teamid_entitytype]
                , [llp_teamidname]
                , [llp_teamidyominame]
                , [llp_utapprovaltemplateid]
                , [llp_utapprovaltemplateid_entitytype]
                , [llp_utapprovaltemplateidname]
                , [llp_utreservationapproverid]
                , [llp_utreservationapproverid_entitytype]
                , [llp_utreservationapproveridname]
                , [llp_utreservationapproveridyominame]
                , [modifiedby]
                , [modifiedby_entitytype]
                , [modifiedbyname]
                , [modifiedbyyominame]
                , [modifiedon]
                , [modifiedonbehalfby]
                , [modifiedonbehalfby_entitytype]
                , [modifiedonbehalfbyname]
                , [modifiedonbehalfbyyominame]
                , [name]
                , [organizationid]
                , [organizationid_entitytype]
                , [organizationidname]
                , [overriddencreatedon]
                , [parentbusinessunitid]
                , [parentbusinessunitid_entitytype]
                , [parentbusinessunitidname]
                , [picture]
                , [SinkCreatedOn]
                , [SinkModifiedOn]
                , [stockexchange]
                , [tickersymbol]
                , [transactioncurrencyid]
                , [transactioncurrencyid_entitytype]
                , [transactioncurrencyidname]
                , [usergroupid]
                , [utcoffset]
                , [versionnumber]
                , [websiteurl]
                , [workflowsuspended]
                , [DataSourceId]
                , [ThreadLogId]
    )

        SELECT 
                [address1_addressid] = s.[address1_addressid]
                , [address1_addresstypecode] = s.[address1_addresstypecode]
                , [address1_city] = s.[address1_city]
                , [address1_country] = s.[address1_country]
                , [address1_county] = s.[address1_county]
                , [address1_fax] = s.[address1_fax]
                , [address1_latitude] = s.[address1_latitude]
                , [address1_line1] = s.[address1_line1]
                , [address1_line2] = s.[address1_line2]
                , [address1_line3] = s.[address1_line3]
                , [address1_longitude] = s.[address1_longitude]
                , [address1_name] = s.[address1_name]
                , [address1_postalcode] = s.[address1_postalcode]
                , [address1_postofficebox] = s.[address1_postofficebox]
                , [address1_shippingmethodcode] = s.[address1_shippingmethodcode]
                , [address1_stateorprovince] = s.[address1_stateorprovince]
                , [address1_telephone1] = s.[address1_telephone1]
                , [address1_telephone2] = s.[address1_telephone2]
                , [address1_telephone3] = s.[address1_telephone3]
                , [address1_upszone] = s.[address1_upszone]
                , [address1_utcoffset] = s.[address1_utcoffset]
                , [address2_addressid] = s.[address2_addressid]
                , [address2_addresstypecode] = s.[address2_addresstypecode]
                , [address2_city] = s.[address2_city]
                , [address2_country] = s.[address2_country]
                , [address2_county] = s.[address2_county]
                , [address2_fax] = s.[address2_fax]
                , [address2_latitude] = s.[address2_latitude]
                , [address2_line1] = s.[address2_line1]
                , [address2_line2] = s.[address2_line2]
                , [address2_line3] = s.[address2_line3]
                , [address2_longitude] = s.[address2_longitude]
                , [address2_name] = s.[address2_name]
                , [address2_postalcode] = s.[address2_postalcode]
                , [address2_postofficebox] = s.[address2_postofficebox]
                , [address2_shippingmethodcode] = s.[address2_shippingmethodcode]
                , [address2_stateorprovince] = s.[address2_stateorprovince]
                , [address2_telephone1] = s.[address2_telephone1]
                , [address2_telephone2] = s.[address2_telephone2]
                , [address2_telephone3] = s.[address2_telephone3]
                , [address2_upszone] = s.[address2_upszone]
                , [address2_utcoffset] = s.[address2_utcoffset]
                , [businessunitid] = s.[businessunitid]
                , [calendarid] = s.[calendarid]
                , [calendarid_entitytype] = s.[calendarid_entitytype]
                , [costcenter] = s.[costcenter]
                , [createdby] = s.[createdby]
                , [createdby_entitytype] = s.[createdby_entitytype]
                , [createdbyname] = s.[createdbyname]
                , [createdbyyominame] = s.[createdbyyominame]
                , [createdon] = s.[createdon]
                , [createdonbehalfby] = s.[createdonbehalfby]
                , [createdonbehalfby_entitytype] = s.[createdonbehalfby_entitytype]
                , [createdonbehalfbyname] = s.[createdonbehalfbyname]
                , [createdonbehalfbyyominame] = s.[createdonbehalfbyyominame]
                , [creditlimit] = s.[creditlimit]
                , [description] = s.[description]
                , [disabledreason] = s.[disabledreason]
                , [divisionname] = s.[divisionname]
                , [emailaddress] = s.[emailaddress]
                , [exchangerate] = s.[exchangerate]
                , [fileasname] = s.[fileasname]
                , [ftpsiteurl] = s.[ftpsiteurl]
                , [Id] = s.[Id]
                , [importsequencenumber] = s.[importsequencenumber]
                , [inheritancemask] = s.[inheritancemask]
                , [isdisabled] = s.[isdisabled]
                , [llp_countryid] = s.[llp_countryid]
                , [llp_countryid_entitytype] = s.[llp_countryid_entitytype]
                , [llp_countryidname] = s.[llp_countryidname]
                , [llp_iddealernr] = s.[llp_iddealernr]
                , [llp_idnetsuite] = s.[llp_idnetsuite]
                , [llp_isworkshop] = s.[llp_isworkshop]
                , [llp_teamid] = s.[llp_teamid]
                , [llp_teamid_entitytype] = s.[llp_teamid_entitytype]
                , [llp_teamidname] = s.[llp_teamidname]
                , [llp_teamidyominame] = s.[llp_teamidyominame]
                , [llp_utapprovaltemplateid] = s.[llp_utapprovaltemplateid]
                , [llp_utapprovaltemplateid_entitytype] = s.[llp_utapprovaltemplateid_entitytype]
                , [llp_utapprovaltemplateidname] = s.[llp_utapprovaltemplateidname]
                , [llp_utreservationapproverid] = s.[llp_utreservationapproverid]
                , [llp_utreservationapproverid_entitytype] = s.[llp_utreservationapproverid_entitytype]
                , [llp_utreservationapproveridname] = s.[llp_utreservationapproveridname]
                , [llp_utreservationapproveridyominame] = s.[llp_utreservationapproveridyominame]
                , [modifiedby] = s.[modifiedby]
                , [modifiedby_entitytype] = s.[modifiedby_entitytype]
                , [modifiedbyname] = s.[modifiedbyname]
                , [modifiedbyyominame] = s.[modifiedbyyominame]
                , [modifiedon] = s.[modifiedon]
                , [modifiedonbehalfby] = s.[modifiedonbehalfby]
                , [modifiedonbehalfby_entitytype] = s.[modifiedonbehalfby_entitytype]
                , [modifiedonbehalfbyname] = s.[modifiedonbehalfbyname]
                , [modifiedonbehalfbyyominame] = s.[modifiedonbehalfbyyominame]
                , [name] = s.[name]
                , [organizationid] = s.[organizationid]
                , [organizationid_entitytype] = s.[organizationid_entitytype]
                , [organizationidname] = s.[organizationidname]
                , [overriddencreatedon] = s.[overriddencreatedon]
                , [parentbusinessunitid] = s.[parentbusinessunitid]
                , [parentbusinessunitid_entitytype] = s.[parentbusinessunitid_entitytype]
                , [parentbusinessunitidname] = s.[parentbusinessunitidname]
                , [picture] = s.[picture]
                , [SinkCreatedOn] = s.[SinkCreatedOn]
                , [SinkModifiedOn] = s.[SinkModifiedOn]
                , [stockexchange] = s.[stockexchange]
                , [tickersymbol] = s.[tickersymbol]
                , [transactioncurrencyid] = s.[transactioncurrencyid]
                , [transactioncurrencyid_entitytype] = s.[transactioncurrencyid_entitytype]
                , [transactioncurrencyidname] = s.[transactioncurrencyidname]
                , [usergroupid] = s.[usergroupid]
                , [utcoffset] = s.[utcoffset]
                , [versionnumber] = s.[versionnumber]
                , [websiteurl] = s.[websiteurl]
                , [workflowsuspended] = s.[workflowsuspended]
                , [DataSourceId] = @DataSourceId
                , [ThreadLogId] = @ThreadLogId
    
        FROM [scaniacrmexport.database.windows.net].[ScaniaCRMExport].[dbo].[businessunit] AS s WITH (NOLOCK)

        --Log ThreadLog Success
        UPDATE Etl.ThreadLog
        SET ExtractRowCount = (SELECT COUNT(*) FROM [Stage].[CRMdboBusinessunit] WITH (NOLOCK) WHERE ThreadLogId = @ThreadLogId)
            , InsertRowCount = (SELECT COUNT(*) FROM [Stage].[CRMdboBusinessunit] WITH (NOLOCK) WHERE ThreadLogId = @ThreadLogId)
            , TableFinalRowCount = (SELECT COUNT(*) FROM [Stage].[CRMdboBusinessunit] WITH (NOLOCK) )
            , EndTime = GETDATE()
            , LoadDateFrom = @loadDateFrom
            , LoadDateTo = GETDATE()
            , StatusId = 3
        WHERE ThreadLogId = @ThreadLogId;

        END TRY

        BEGIN CATCH
            EXEC [dbo].[uspErrorHandler] @ThreadLogId = @ThreadLogId;
        END CATCH
            
        RETURN;
```

\[Back to stored procedure list\]\[listofprocedures\]
