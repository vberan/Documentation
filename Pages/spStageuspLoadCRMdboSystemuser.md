Stored Procedure Stage.uspLoadCRMdboSystemuser {#spStageuspLoadCRMdboSystemuser}
----------------------------------------------

Definition of Stored procedure:

``` {.sql}
CREATE PROCEDURE [Stage].[uspLoadCRMdboSystemuser] 
    @ThreadLogId int
        , @DataSourceId int
    AS
    BEGIN TRY
        -- set up the enviroment
        SET NOCOUNT ON;
    

        TRUNCATE TABLE [Stage].[CRMdboSystemuser]; 

        -- log the initial table state
        UPDATE Etl.ThreadLog
            SET TableInitialRowCount = (SELECT COUNT(*) FROM [Stage].[CRMdboSystemuser] WITH (NOLOCK))
        WHERE ThreadLogId = @ThreadLogId;

        DECLARE @loadDateFrom datetime2;
        SELECT @loadDateFrom = '1901-01-01';

        INSERT INTO [Stage].[CRMdboSystemuser]
            ( 
                [accessmode]
                , [activedirectoryguid]
                , [address1_addressid]
                , [address1_addresstypecode]
                , [address1_city]
                , [address1_composite]
                , [address1_country]
                , [address1_county]
                , [address1_fax]
                , [address1_latitude]
                , [address1_line1]
                , [address1_line2]
                , [address1_line3]
                , [address1_longitude]
                , [address1_name]
                , [address1_postalcode]
                , [address1_postofficebox]
                , [address1_shippingmethodcode]
                , [address1_stateorprovince]
                , [address1_telephone1]
                , [address1_telephone2]
                , [address1_telephone3]
                , [address1_upszone]
                , [address1_utcoffset]
                , [address2_addressid]
                , [address2_addresstypecode]
                , [address2_city]
                , [address2_composite]
                , [address2_country]
                , [address2_county]
                , [address2_fax]
                , [address2_latitude]
                , [address2_line1]
                , [address2_line2]
                , [address2_line3]
                , [address2_longitude]
                , [address2_name]
                , [address2_postalcode]
                , [address2_postofficebox]
                , [address2_shippingmethodcode]
                , [address2_stateorprovince]
                , [address2_telephone1]
                , [address2_telephone2]
                , [address2_telephone3]
                , [address2_upszone]
                , [address2_utcoffset]
                , [applicationid]
                , [applicationiduri]
                , [azureactivedirectoryobjectid]
                , [businessunitid]
                , [businessunitid_entitytype]
                , [businessunitidname]
                , [calendarid]
                , [calendarid_entitytype]
                , [caltype]
                , [createdby]
                , [createdby_entitytype]
                , [createdbyname]
                , [createdbyyominame]
                , [createdon]
                , [createdonbehalfby]
                , [createdonbehalfby_entitytype]
                , [createdonbehalfbyname]
                , [createdonbehalfbyyominame]
                , [defaultfilterspopulated]
                , [defaultmailbox]
                , [defaultmailbox_entitytype]
                , [defaultmailboxname]
                , [defaultodbfoldername]
                , [disabledreason]
                , [displayinserviceviews]
                , [domainname]
                , [emailrouteraccessapproval]
                , [employeeid]
                , [entityimage_timestamp]
                , [entityimage_url]
                , [entityimageid]
                , [exchangerate]
                , [firstname]
                , [fullname]
                , [governmentid]
                , [homephone]
                , [Id]
                , [identityid]
                , [importsequencenumber]
                , [incomingemaildeliverymethod]
                , [internalemailaddress]
                , [invitestatuscode]
                , [isactivedirectoryuser]
                , [isdisabled]
                , [isemailaddressapprovedbyo365admin]
                , [isintegrationuser]
                , [islicensed]
                , [issyncwithdirectory]
                , [jobtitle]
                , [lastname]
                , [latestupdatetime]
                , [llp_arbesdbname]
                , [llp_arbessyncallowed]
                , [llp_automastersyncallowed]
                , [llp_automastersyncdbname]
                , [llp_automaticallysendtoautomaster]
                , [llp_certsyncallowed]
                , [llp_certsyncdbname]
                , [llp_defaultopportunitytype]
                , [llp_idnetsuite]
                , [llp_sfinsuranceid]
                , [llp_sfinsuranceid_entitytype]
                , [llp_sfinsuranceidname]
                , [llp_sfinsuranceidyominame]
                , [llp_sfsalespersonid]
                , [llp_sfsalespersonid_entitytype]
                , [llp_sfsalespersonidname]
                , [llp_sfsalespersonidyominame]
                , [llp_sportlanguage]
                , [llp_sportsellergroup]
                , [llp_sportsellerorganization]
                , [llp_utsalespersonid]
                , [llp_utsalespersonid_entitytype]
                , [llp_utsalespersonidname]
                , [llp_utsalespersonidyominame]
                , [llp_xdslogin]
                , [middlename]
                , [mobilealertemail]
                , [mobileofflineprofileid]
                , [mobileofflineprofileid_entitytype]
                , [mobileofflineprofileidname]
                , [mobilephone]
                , [modifiedby]
                , [modifiedby_entitytype]
                , [modifiedbyname]
                , [modifiedbyyominame]
                , [modifiedon]
                , [modifiedonbehalfby]
                , [modifiedonbehalfby_entitytype]
                , [modifiedonbehalfbyname]
                , [modifiedonbehalfbyyominame]
                , [msdyn_gdproptout]
                , [nickname]
                , [organizationid]
                , [organizationidname]
                , [outgoingemaildeliverymethod]
                , [overriddencreatedon]
                , [parentsystemuserid]
                , [parentsystemuserid_entitytype]
                , [parentsystemuseridname]
                , [parentsystemuseridyominame]
                , [passporthi]
                , [passportlo]
                , [personalemailaddress]
                , [photourl]
                , [positionid]
                , [positionid_entitytype]
                , [positionidname]
                , [preferredaddresscode]
                , [preferredemailcode]
                , [preferredphonecode]
                , [processid]
                , [queueid]
                , [queueid_entitytype]
                , [queueidname]
                , [salutation]
                , [setupuser]
                , [sharepointemailaddress]
                , [SinkCreatedOn]
                , [SinkModifiedOn]
                , [siteid]
                , [siteid_entitytype]
                , [siteidname]
                , [skills]
                , [stageid]
                , [systemuserid]
                , [territoryid]
                , [territoryid_entitytype]
                , [territoryidname]
                , [timezoneruleversionnumber]
                , [title]
                , [transactioncurrencyid]
                , [transactioncurrencyid_entitytype]
                , [transactioncurrencyidname]
                , [traversedpath]
                , [userlicensetype]
                , [userpuid]
                , [utcconversiontimezonecode]
                , [versionnumber]
                , [windowsliveid]
                , [yammeremailaddress]
                , [yammeruserid]
                , [yomifirstname]
                , [yomifullname]
                , [yomilastname]
                , [yomimiddlename]
                , [DataSourceId]
                , [ThreadLogId]
    )

        SELECT 
                [accessmode] = s.[accessmode]
                , [activedirectoryguid] = s.[activedirectoryguid]
                , [address1_addressid] = s.[address1_addressid]
                , [address1_addresstypecode] = s.[address1_addresstypecode]
                , [address1_city] = s.[address1_city]
                , [address1_composite] = s.[address1_composite]
                , [address1_country] = s.[address1_country]
                , [address1_county] = s.[address1_county]
                , [address1_fax] = s.[address1_fax]
                , [address1_latitude] = s.[address1_latitude]
                , [address1_line1] = s.[address1_line1]
                , [address1_line2] = s.[address1_line2]
                , [address1_line3] = s.[address1_line3]
                , [address1_longitude] = s.[address1_longitude]
                , [address1_name] = s.[address1_name]
                , [address1_postalcode] = s.[address1_postalcode]
                , [address1_postofficebox] = s.[address1_postofficebox]
                , [address1_shippingmethodcode] = s.[address1_shippingmethodcode]
                , [address1_stateorprovince] = s.[address1_stateorprovince]
                , [address1_telephone1] = s.[address1_telephone1]
                , [address1_telephone2] = s.[address1_telephone2]
                , [address1_telephone3] = s.[address1_telephone3]
                , [address1_upszone] = s.[address1_upszone]
                , [address1_utcoffset] = s.[address1_utcoffset]
                , [address2_addressid] = s.[address2_addressid]
                , [address2_addresstypecode] = s.[address2_addresstypecode]
                , [address2_city] = s.[address2_city]
                , [address2_composite] = s.[address2_composite]
                , [address2_country] = s.[address2_country]
                , [address2_county] = s.[address2_county]
                , [address2_fax] = s.[address2_fax]
                , [address2_latitude] = s.[address2_latitude]
                , [address2_line1] = s.[address2_line1]
                , [address2_line2] = s.[address2_line2]
                , [address2_line3] = s.[address2_line3]
                , [address2_longitude] = s.[address2_longitude]
                , [address2_name] = s.[address2_name]
                , [address2_postalcode] = s.[address2_postalcode]
                , [address2_postofficebox] = s.[address2_postofficebox]
                , [address2_shippingmethodcode] = s.[address2_shippingmethodcode]
                , [address2_stateorprovince] = s.[address2_stateorprovince]
                , [address2_telephone1] = s.[address2_telephone1]
                , [address2_telephone2] = s.[address2_telephone2]
                , [address2_telephone3] = s.[address2_telephone3]
                , [address2_upszone] = s.[address2_upszone]
                , [address2_utcoffset] = s.[address2_utcoffset]
                , [applicationid] = s.[applicationid]
                , [applicationiduri] = s.[applicationiduri]
                , [azureactivedirectoryobjectid] = s.[azureactivedirectoryobjectid]
                , [businessunitid] = s.[businessunitid]
                , [businessunitid_entitytype] = s.[businessunitid_entitytype]
                , [businessunitidname] = s.[businessunitidname]
                , [calendarid] = s.[calendarid]
                , [calendarid_entitytype] = s.[calendarid_entitytype]
                , [caltype] = s.[caltype]
                , [createdby] = s.[createdby]
                , [createdby_entitytype] = s.[createdby_entitytype]
                , [createdbyname] = s.[createdbyname]
                , [createdbyyominame] = s.[createdbyyominame]
                , [createdon] = s.[createdon]
                , [createdonbehalfby] = s.[createdonbehalfby]
                , [createdonbehalfby_entitytype] = s.[createdonbehalfby_entitytype]
                , [createdonbehalfbyname] = s.[createdonbehalfbyname]
                , [createdonbehalfbyyominame] = s.[createdonbehalfbyyominame]
                , [defaultfilterspopulated] = s.[defaultfilterspopulated]
                , [defaultmailbox] = s.[defaultmailbox]
                , [defaultmailbox_entitytype] = s.[defaultmailbox_entitytype]
                , [defaultmailboxname] = s.[defaultmailboxname]
                , [defaultodbfoldername] = s.[defaultodbfoldername]
                , [disabledreason] = s.[disabledreason]
                , [displayinserviceviews] = s.[displayinserviceviews]
                , [domainname] = s.[domainname]
                , [emailrouteraccessapproval] = s.[emailrouteraccessapproval]
                , [employeeid] = s.[employeeid]
                , [entityimage_timestamp] = s.[entityimage_timestamp]
                , [entityimage_url] = s.[entityimage_url]
                , [entityimageid] = s.[entityimageid]
                , [exchangerate] = s.[exchangerate]
                , [firstname] = s.[firstname]
                , [fullname] = s.[fullname]
                , [governmentid] = s.[governmentid]
                , [homephone] = s.[homephone]
                , [Id] = s.[Id]
                , [identityid] = s.[identityid]
                , [importsequencenumber] = s.[importsequencenumber]
                , [incomingemaildeliverymethod] = s.[incomingemaildeliverymethod]
                , [internalemailaddress] = s.[internalemailaddress]
                , [invitestatuscode] = s.[invitestatuscode]
                , [isactivedirectoryuser] = s.[isactivedirectoryuser]
                , [isdisabled] = s.[isdisabled]
                , [isemailaddressapprovedbyo365admin] = s.[isemailaddressapprovedbyo365admin]
                , [isintegrationuser] = s.[isintegrationuser]
                , [islicensed] = s.[islicensed]
                , [issyncwithdirectory] = s.[issyncwithdirectory]
                , [jobtitle] = s.[jobtitle]
                , [lastname] = s.[lastname]
                , [latestupdatetime] = s.[latestupdatetime]
                , [llp_arbesdbname] = s.[llp_arbesdbname]
                , [llp_arbessyncallowed] = s.[llp_arbessyncallowed]
                , [llp_automastersyncallowed] = s.[llp_automastersyncallowed]
                , [llp_automastersyncdbname] = s.[llp_automastersyncdbname]
                , [llp_automaticallysendtoautomaster] = s.[llp_automaticallysendtoautomaster]
                , [llp_certsyncallowed] = s.[llp_certsyncallowed]
                , [llp_certsyncdbname] = s.[llp_certsyncdbname]
                , [llp_defaultopportunitytype] = s.[llp_defaultopportunitytype]
                , [llp_idnetsuite] = s.[llp_idnetsuite]
                , [llp_sfinsuranceid] = s.[llp_sfinsuranceid]
                , [llp_sfinsuranceid_entitytype] = s.[llp_sfinsuranceid_entitytype]
                , [llp_sfinsuranceidname] = s.[llp_sfinsuranceidname]
                , [llp_sfinsuranceidyominame] = s.[llp_sfinsuranceidyominame]
                , [llp_sfsalespersonid] = s.[llp_sfsalespersonid]
                , [llp_sfsalespersonid_entitytype] = s.[llp_sfsalespersonid_entitytype]
                , [llp_sfsalespersonidname] = s.[llp_sfsalespersonidname]
                , [llp_sfsalespersonidyominame] = s.[llp_sfsalespersonidyominame]
                , [llp_sportlanguage] = s.[llp_sportlanguage]
                , [llp_sportsellergroup] = s.[llp_sportsellergroup]
                , [llp_sportsellerorganization] = s.[llp_sportsellerorganization]
                , [llp_utsalespersonid] = s.[llp_utsalespersonid]
                , [llp_utsalespersonid_entitytype] = s.[llp_utsalespersonid_entitytype]
                , [llp_utsalespersonidname] = s.[llp_utsalespersonidname]
                , [llp_utsalespersonidyominame] = s.[llp_utsalespersonidyominame]
                , [llp_xdslogin] = s.[llp_xdslogin]
                , [middlename] = s.[middlename]
                , [mobilealertemail] = s.[mobilealertemail]
                , [mobileofflineprofileid] = s.[mobileofflineprofileid]
                , [mobileofflineprofileid_entitytype] = s.[mobileofflineprofileid_entitytype]
                , [mobileofflineprofileidname] = s.[mobileofflineprofileidname]
                , [mobilephone] = s.[mobilephone]
                , [modifiedby] = s.[modifiedby]
                , [modifiedby_entitytype] = s.[modifiedby_entitytype]
                , [modifiedbyname] = s.[modifiedbyname]
                , [modifiedbyyominame] = s.[modifiedbyyominame]
                , [modifiedon] = s.[modifiedon]
                , [modifiedonbehalfby] = s.[modifiedonbehalfby]
                , [modifiedonbehalfby_entitytype] = s.[modifiedonbehalfby_entitytype]
                , [modifiedonbehalfbyname] = s.[modifiedonbehalfbyname]
                , [modifiedonbehalfbyyominame] = s.[modifiedonbehalfbyyominame]
                , [msdyn_gdproptout] = s.[msdyn_gdproptout]
                , [nickname] = s.[nickname]
                , [organizationid] = s.[organizationid]
                , [organizationidname] = s.[organizationidname]
                , [outgoingemaildeliverymethod] = s.[outgoingemaildeliverymethod]
                , [overriddencreatedon] = s.[overriddencreatedon]
                , [parentsystemuserid] = s.[parentsystemuserid]
                , [parentsystemuserid_entitytype] = s.[parentsystemuserid_entitytype]
                , [parentsystemuseridname] = s.[parentsystemuseridname]
                , [parentsystemuseridyominame] = s.[parentsystemuseridyominame]
                , [passporthi] = s.[passporthi]
                , [passportlo] = s.[passportlo]
                , [personalemailaddress] = s.[personalemailaddress]
                , [photourl] = s.[photourl]
                , [positionid] = s.[positionid]
                , [positionid_entitytype] = s.[positionid_entitytype]
                , [positionidname] = s.[positionidname]
                , [preferredaddresscode] = s.[preferredaddresscode]
                , [preferredemailcode] = s.[preferredemailcode]
                , [preferredphonecode] = s.[preferredphonecode]
                , [processid] = s.[processid]
                , [queueid] = s.[queueid]
                , [queueid_entitytype] = s.[queueid_entitytype]
                , [queueidname] = s.[queueidname]
                , [salutation] = s.[salutation]
                , [setupuser] = s.[setupuser]
                , [sharepointemailaddress] = s.[sharepointemailaddress]
                , [SinkCreatedOn] = s.[SinkCreatedOn]
                , [SinkModifiedOn] = s.[SinkModifiedOn]
                , [siteid] = s.[siteid]
                , [siteid_entitytype] = s.[siteid_entitytype]
                , [siteidname] = s.[siteidname]
                , [skills] = s.[skills]
                , [stageid] = s.[stageid]
                , [systemuserid] = s.[systemuserid]
                , [territoryid] = s.[territoryid]
                , [territoryid_entitytype] = s.[territoryid_entitytype]
                , [territoryidname] = s.[territoryidname]
                , [timezoneruleversionnumber] = s.[timezoneruleversionnumber]
                , [title] = s.[title]
                , [transactioncurrencyid] = s.[transactioncurrencyid]
                , [transactioncurrencyid_entitytype] = s.[transactioncurrencyid_entitytype]
                , [transactioncurrencyidname] = s.[transactioncurrencyidname]
                , [traversedpath] = s.[traversedpath]
                , [userlicensetype] = s.[userlicensetype]
                , [userpuid] = s.[userpuid]
                , [utcconversiontimezonecode] = s.[utcconversiontimezonecode]
                , [versionnumber] = s.[versionnumber]
                , [windowsliveid] = s.[windowsliveid]
                , [yammeremailaddress] = s.[yammeremailaddress]
                , [yammeruserid] = s.[yammeruserid]
                , [yomifirstname] = s.[yomifirstname]
                , [yomifullname] = s.[yomifullname]
                , [yomilastname] = s.[yomilastname]
                , [yomimiddlename] = s.[yomimiddlename]
                , [DataSourceId] = @DataSourceId
                , [ThreadLogId] = @ThreadLogId
    
        FROM [scaniacrmexport.database.windows.net].[ScaniaCRMExport].[dbo].[systemuser] AS s WITH (NOLOCK)

        --Log ThreadLog Success
        UPDATE Etl.ThreadLog
        SET ExtractRowCount = (SELECT COUNT(*) FROM [Stage].[CRMdboSystemuser] WITH (NOLOCK) WHERE ThreadLogId = @ThreadLogId)
            , InsertRowCount = (SELECT COUNT(*) FROM [Stage].[CRMdboSystemuser] WITH (NOLOCK) WHERE ThreadLogId = @ThreadLogId)
            , TableFinalRowCount = (SELECT COUNT(*) FROM [Stage].[CRMdboSystemuser] WITH (NOLOCK) )
            , EndTime = GETDATE()
            , LoadDateFrom = @loadDateFrom
            , LoadDateTo = GETDATE()
            , StatusId = 3
        WHERE ThreadLogId = @ThreadLogId;

        END TRY

        BEGIN CATCH
            EXEC [dbo].[uspErrorHandler] @ThreadLogId = @ThreadLogId;
        END CATCH
            
        RETURN;
```

\[Back to stored procedure list\]\[listofprocedures\]
