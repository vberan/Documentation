Stored Procedure Stage.uspLoadCRMdboOpportunity {#spStageuspLoadCRMdboOpportunity}
-----------------------------------------------

Definition of Stored procedure:

``` {.sql}
CREATE PROCEDURE [Stage].[uspLoadCRMdboOpportunity] 
    @ThreadLogId int
        , @DataSourceId int
    AS
    BEGIN TRY
        -- set up the enviroment
        SET NOCOUNT ON;
    

        TRUNCATE TABLE [Stage].[CRMdboOpportunity]; 

        -- log the initial table state
        UPDATE Etl.ThreadLog
            SET TableInitialRowCount = (SELECT COUNT(*) FROM [Stage].[CRMdboOpportunity] WITH (NOLOCK))
        WHERE ThreadLogId = @ThreadLogId;

        DECLARE @loadDateFrom datetime2;
        SELECT @loadDateFrom = '1901-01-01';

        INSERT INTO [Stage].[CRMdboOpportunity]
            ( 
                [accountid]
                , [accountid_entitytype]
                , [accountidname]
                , [accountidyominame]
                , [actualclosedate]
                , [actualvalue]
                , [actualvalue_base]
                , [budgetamount]
                , [budgetamount_base]
                , [budgetstatus]
                , [campaignid]
                , [campaignid_entitytype]
                , [campaignidname]
                , [captureproposalfeedback]
                , [closeprobability]
                , [completefinalproposal]
                , [completeinternalreview]
                , [confirminterest]
                , [contactid]
                , [contactid_entitytype]
                , [contactidname]
                , [contactidyominame]
                , [createdby]
                , [createdby_entitytype]
                , [createdbyname]
                , [createdbyyominame]
                , [createdon]
                , [createdonbehalfby]
                , [createdonbehalfby_entitytype]
                , [createdonbehalfbyname]
                , [createdonbehalfbyyominame]
                , [currentsituation]
                , [customerid]
                , [customerid_entitytype]
                , [customeridname]
                , [customeridtype]
                , [customeridyominame]
                , [customerneed]
                , [customerpainpoints]
                , [decisionmaker]
                , [description]
                , [developproposal]
                , [discountamount]
                , [discountamount_base]
                , [discountpercentage]
                , [emailaddress]
                , [estimatedclosedate]
                , [estimatedvalue]
                , [estimatedvalue_base]
                , [evaluatefit]
                , [exchangerate]
                , [filedebrief]
                , [finaldecisiondate]
                , [freightamount]
                , [freightamount_base]
                , [Id]
                , [identifycompetitors]
                , [identifycustomercontacts]
                , [identifypursuitteam]
                , [importsequencenumber]
                , [initialcommunication]
                , [isprivate]
                , [isrevenuesystemcalculated]
                , [lastonholdtime]
                , [llp_add]
                , [llp_agreedhandoverdate]
                , [llp_alltrucksapprovedandaccepted]
                , [llp_approvalstatus]
                , [llp_assetprice]
                , [llp_assetprice_base]
                , [llp_automaticallycreatedsfopp]
                , [llp_automaticallycreatedsiopp]
                , [llp_averageoverdueinlast2years]
                , [llp_bodybuildingcontractsigned]
                , [llp_bodybuildingcoordinatedby]
                , [llp_bodybuildinggeneralsupplierid]
                , [llp_bodybuildinggeneralsupplierid_entitytype]
                , [llp_bodybuildinggeneralsupplieridname]
                , [llp_bodybuildinggeneralsupplieridyominame]
                , [llp_bodybuildinghandoverdate]
                , [llp_bodywork]
                , [llp_buofvehicleid]
                , [llp_buofvehicleid_entitytype]
                , [llp_buofvehicleidname]
                , [llp_cdd]
                , [llp_checkedofcustomerneeds]
                , [llp_competitors]
                , [llp_competitorsinsuraceother]
                , [llp_competitorsinsurance]
                , [llp_competitorsinsuranceselection]
                , [llp_competitorsleasingother]
                , [llp_competitorsselection]
                , [llp_contractlenght]
                , [llp_contractlengthmonth]
                , [llp_contractsigned]
                , [llp_contractsignedby]
                , [llp_contractsignedby_entitytype]
                , [llp_contractsignedbyname]
                , [llp_contractsignedbyon]
                , [llp_contractsignedbyyominame]
                , [llp_contracttype]
                , [llp_countofofferedtrucks]
                , [llp_countofofferedtrucks_date]
                , [llp_countofofferedtrucks_state]
                , [llp_countrieswerefilled]
                , [llp_createdonreport]
                , [llp_createsportoffer]
                , [llp_creditapplicationapproved]
                , [llp_creditapplicationcreated]
                , [llp_creditprecheckdone]
                , [llp_currency]
                , [llp_currency_base]
                , [llp_currentfleetmileage]
                , [llp_currentfleetmileagekmyear]
                , [llp_customeracceptedtheoffer]
                , [llp_customerbillingaddress]
                , [llp_customeremail]
                , [llp_customername]
                , [llp_customerphone]
                , [llp_customerswerefilled]
                , [llp_deliverycompleted]
                , [llp_deliverydate]
                , [llp_dout]
                , [llp_downpayment]
                , [llp_dppercent]
                , [llp_estimatedbodybuildingcompletiondate]
                , [llp_estimateddeliverydate]
                , [llp_estimatedorderdate]
                , [llp_externalfinancing]
                , [llp_financing2]
                , [llp_financingapproved]
                , [llp_financingconfirmed]
                , [llp_financinghidden]
                , [llp_financingnoreasonother]
                , [llp_financingnothereason]
                , [llp_financingopportunitycreated]
                , [llp_gdprcheck]
                , [llp_htmlspread]
                , [llp_indicativeofferaccepted]
                , [llp_indicativeofferwassaved]
                , [llp_informationdirectlyfromcustomer]
                , [llp_informationfromjusticecz]
                , [llp_insurance2]
                , [llp_insurancehidden]
                , [llp_insuranceprice]
                , [llp_insuranceprice_base]
                , [llp_insuranceproductsselection]
                , [llp_insuranceproductswereselected]
                , [llp_insurenceoffersend]
                , [llp_insurersselection]
                , [llp_insurerswereselected]
                , [llp_integrationsportguid]
                , [llp_km]
                , [llp_knownrivaloffer]
                , [llp_leasingasset]
                , [llp_lockguid]
                , [llp_lossratiopercent]
                , [llp_margin]
                , [llp_maxage]
                , [llp_maxmileage]
                , [llp_maxprice]
                , [llp_maxprice_base]
                , [llp_meetingwithbodybuilder]
                , [llp_netsuitechange]
                , [llp_newpurchasemileagekmyear]
                , [llp_newpurchusemileage]
                , [llp_notifydrivecoach]
                , [llp_numberofitemsofobjectspecification]
                , [llp_numberofitemsofobjectspecification_date]
                , [llp_numberofitemsofobjectspecification_state]
                , [llp_numberoftrucks]
                , [llp_numberoftrucksinfleet]
                , [llp_objectspecificationcompleted]
                , [llp_offeraccepted]
                , [llp_offeracceptedbycustomer]
                , [llp_opportunitycountries_count]
                , [llp_opportunitycountries_weightsum]
                , [llp_opportunitycustomer_count]
                , [llp_opportunitycustomer_weightsum]
                , [llp_opportunityforfinancingwaslost]
                , [llp_opportunitynumber]
                , [llp_opportunitypreferableinsurer_count]
                , [llp_opportunitytype]
                , [llp_opportunitytypeofinsurance_count]
                , [llp_parentalbuid]
                , [llp_parentalbuid_entitytype]
                , [llp_parentalbuidname]
                , [llp_pdicomplete]
                , [llp_peakinlastyear]
                , [llp_preferableinsurerid]
                , [llp_preferableinsurerid_entitytype]
                , [llp_preferableinsureridname]
                , [llp_preferedfinancialproduct]
                , [llp_primaryquoteid]
                , [llp_primaryquoteid_entitytype]
                , [llp_primaryquoteidname]
                , [llp_proposalsentdate]
                , [llp_proposedprice]
                , [llp_proposedprice_base]
                , [llp_recordapproved]
                , [llp_regno]
                , [llp_remark]
                , [llp_reservevehicle]
                , [llp_service]
                , [llp_servicesactivated]
                , [llp_sfcategory]
                , [llp_sourceopportunityid]
                , [llp_sourceopportunityid_entitytype]
                , [llp_sourceopportunityidname]
                , [llp_spreadapplicationapproved]
                , [llp_spreadapplicationmarginreason]
                , [llp_subjecttbfinanced]
                , [llp_tradein]
                , [llp_tradeinrequestcompleted]
                , [llp_trucktype]
                , [llp_typeofinsuranceproduct]
                , [llp_typeoftransport]
                , [llp_typeoftransportselection]
                , [llp_urljusticecz]
                , [llp_utreservationapprovalrequired]
                , [llp_utreservationapproverhiddenid]
                , [llp_utreservationapproverhiddenid_entitytype]
                , [llp_utreservationapproverhiddenidname]
                , [llp_utreservationapproverhiddenidyominame]
                , [llp_utsalespersonid]
                , [llp_utsalespersonid_entitytype]
                , [llp_utsalespersonidname]
                , [llp_utsalespersonidyominame]
                , [llp_vehicleid]
                , [llp_vehicleid_entitytype]
                , [llp_vehicleidname]
                , [llp_vehicleprice]
                , [llp_vehicleprice_base]
                , [llp_vehicleregistrationnumber]
                , [llp_vin]
                , [llp_virtualaccount]
                , [llp_weightsumcountriesissue]
                , [llp_weightsumcustomersissue]
                , [modifiedby]
                , [modifiedby_entitytype]
                , [modifiedbyname]
                , [modifiedbyyominame]
                , [modifiedon]
                , [modifiedonbehalfby]
                , [modifiedonbehalfby_entitytype]
                , [modifiedonbehalfbyname]
                , [modifiedonbehalfbyyominame]
                , [msdyn_forecastcategory]
                , [name]
                , [need]
                , [onholdtime]
                , [opportunityid]
                , [opportunityratingcode]
                , [originatingleadid]
                , [originatingleadid_entitytype]
                , [originatingleadidname]
                , [originatingleadidyominame]
                , [overriddencreatedon]
                , [ownerid]
                , [ownerid_entitytype]
                , [owneridname]
                , [owneridtype]
                , [owneridyominame]
                , [owningbusinessunit]
                , [owningbusinessunit_entitytype]
                , [owningteam]
                , [owningteam_entitytype]
                , [owninguser]
                , [owninguser_entitytype]
                , [parentaccountid]
                , [parentaccountid_entitytype]
                , [parentaccountidname]
                , [parentaccountidyominame]
                , [parentcontactid]
                , [parentcontactid_entitytype]
                , [parentcontactidname]
                , [parentcontactidyominame]
                , [participatesinworkflow]
                , [presentfinalproposal]
                , [presentproposal]
                , [pricelevelid]
                , [pricelevelid_entitytype]
                , [pricelevelidname]
                , [pricingerrorcode]
                , [prioritycode]
                , [processid]
                , [proposedsolution]
                , [purchaseprocess]
                , [purchasetimeframe]
                , [pursuitdecision]
                , [qualificationcomments]
                , [quotecomments]
                , [resolvefeedback]
                , [salesstage]
                , [salesstagecode]
                , [schedulefollowup_prospect]
                , [schedulefollowup_qualify]
                , [scheduleproposalmeeting]
                , [sendthankyounote]
                , [SinkCreatedOn]
                , [SinkModifiedOn]
                , [slaid]
                , [slaid_entitytype]
                , [slainvokedid]
                , [slainvokedid_entitytype]
                , [slainvokedidname]
                , [slaname]
                , [stageid]
                , [statecode]
                , [statuscode]
                , [stepid]
                , [stepname]
                , [teamsfollowed]
                , [timeline]
                , [timespentbymeonemailandmeetings]
                , [timezoneruleversionnumber]
                , [totalamount]
                , [totalamount_base]
                , [totalamountlessfreight]
                , [totalamountlessfreight_base]
                , [totaldiscountamount]
                , [totaldiscountamount_base]
                , [totallineitemamount]
                , [totallineitemamount_base]
                , [totallineitemdiscountamount]
                , [totallineitemdiscountamount_base]
                , [totaltax]
                , [totaltax_base]
                , [transactioncurrencyid]
                , [transactioncurrencyid_entitytype]
                , [transactioncurrencyidname]
                , [traversedpath]
                , [utcconversiontimezonecode]
                , [versionnumber]
                , [wa_brandid]
                , [wa_brandid_entitytype]
                , [wa_brandidname]
                , [wa_externalid]
                , [wa_opportunitygroup]
                , [wa_opportunitygroup_entitytype]
                , [wa_opportunitygroupname]
                , [wa_opportunitysourceid]
                , [wa_opportunitysourceid_entitytype]
                , [wa_opportunitysourceidname]
                , [wa_productid]
                , [wa_productid_entitytype]
                , [wa_productidname]
                , [DataSourceId]
                , [ThreadLogId]
    )

        SELECT 
                [accountid] = s.[accountid]
                , [accountid_entitytype] = s.[accountid_entitytype]
                , [accountidname] = s.[accountidname]
                , [accountidyominame] = s.[accountidyominame]
                , [actualclosedate] = s.[actualclosedate]
                , [actualvalue] = s.[actualvalue]
                , [actualvalue_base] = s.[actualvalue_base]
                , [budgetamount] = s.[budgetamount]
                , [budgetamount_base] = s.[budgetamount_base]
                , [budgetstatus] = s.[budgetstatus]
                , [campaignid] = s.[campaignid]
                , [campaignid_entitytype] = s.[campaignid_entitytype]
                , [campaignidname] = s.[campaignidname]
                , [captureproposalfeedback] = s.[captureproposalfeedback]
                , [closeprobability] = s.[closeprobability]
                , [completefinalproposal] = s.[completefinalproposal]
                , [completeinternalreview] = s.[completeinternalreview]
                , [confirminterest] = s.[confirminterest]
                , [contactid] = s.[contactid]
                , [contactid_entitytype] = s.[contactid_entitytype]
                , [contactidname] = s.[contactidname]
                , [contactidyominame] = s.[contactidyominame]
                , [createdby] = s.[createdby]
                , [createdby_entitytype] = s.[createdby_entitytype]
                , [createdbyname] = s.[createdbyname]
                , [createdbyyominame] = s.[createdbyyominame]
                , [createdon] = s.[createdon]
                , [createdonbehalfby] = s.[createdonbehalfby]
                , [createdonbehalfby_entitytype] = s.[createdonbehalfby_entitytype]
                , [createdonbehalfbyname] = s.[createdonbehalfbyname]
                , [createdonbehalfbyyominame] = s.[createdonbehalfbyyominame]
                , [currentsituation] = s.[currentsituation]
                , [customerid] = s.[customerid]
                , [customerid_entitytype] = s.[customerid_entitytype]
                , [customeridname] = s.[customeridname]
                , [customeridtype] = s.[customeridtype]
                , [customeridyominame] = s.[customeridyominame]
                , [customerneed] = s.[customerneed]
                , [customerpainpoints] = s.[customerpainpoints]
                , [decisionmaker] = s.[decisionmaker]
                , [description] = s.[description]
                , [developproposal] = s.[developproposal]
                , [discountamount] = s.[discountamount]
                , [discountamount_base] = s.[discountamount_base]
                , [discountpercentage] = s.[discountpercentage]
                , [emailaddress] = s.[emailaddress]
                , [estimatedclosedate] = s.[estimatedclosedate]
                , [estimatedvalue] = s.[estimatedvalue]
                , [estimatedvalue_base] = s.[estimatedvalue_base]
                , [evaluatefit] = s.[evaluatefit]
                , [exchangerate] = s.[exchangerate]
                , [filedebrief] = s.[filedebrief]
                , [finaldecisiondate] = s.[finaldecisiondate]
                , [freightamount] = s.[freightamount]
                , [freightamount_base] = s.[freightamount_base]
                , [Id] = s.[Id]
                , [identifycompetitors] = s.[identifycompetitors]
                , [identifycustomercontacts] = s.[identifycustomercontacts]
                , [identifypursuitteam] = s.[identifypursuitteam]
                , [importsequencenumber] = s.[importsequencenumber]
                , [initialcommunication] = s.[initialcommunication]
                , [isprivate] = s.[isprivate]
                , [isrevenuesystemcalculated] = s.[isrevenuesystemcalculated]
                , [lastonholdtime] = s.[lastonholdtime]
                , [llp_add] = s.[llp_add]
                , [llp_agreedhandoverdate] = s.[llp_agreedhandoverdate]
                , [llp_alltrucksapprovedandaccepted] = s.[llp_alltrucksapprovedandaccepted]
                , [llp_approvalstatus] = s.[llp_approvalstatus]
                , [llp_assetprice] = s.[llp_assetprice]
                , [llp_assetprice_base] = s.[llp_assetprice_base]
                , [llp_automaticallycreatedsfopp] = s.[llp_automaticallycreatedsfopp]
                , [llp_automaticallycreatedsiopp] = s.[llp_automaticallycreatedsiopp]
                , [llp_averageoverdueinlast2years] = s.[llp_averageoverdueinlast2years]
                , [llp_bodybuildingcontractsigned] = s.[llp_bodybuildingcontractsigned]
                , [llp_bodybuildingcoordinatedby] = s.[llp_bodybuildingcoordinatedby]
                , [llp_bodybuildinggeneralsupplierid] = s.[llp_bodybuildinggeneralsupplierid]
                , [llp_bodybuildinggeneralsupplierid_entitytype] = s.[llp_bodybuildinggeneralsupplierid_entitytype]
                , [llp_bodybuildinggeneralsupplieridname] = s.[llp_bodybuildinggeneralsupplieridname]
                , [llp_bodybuildinggeneralsupplieridyominame] = s.[llp_bodybuildinggeneralsupplieridyominame]
                , [llp_bodybuildinghandoverdate] = s.[llp_bodybuildinghandoverdate]
                , [llp_bodywork] = s.[llp_bodywork]
                , [llp_buofvehicleid] = s.[llp_buofvehicleid]
                , [llp_buofvehicleid_entitytype] = s.[llp_buofvehicleid_entitytype]
                , [llp_buofvehicleidname] = s.[llp_buofvehicleidname]
                , [llp_cdd] = s.[llp_cdd]
                , [llp_checkedofcustomerneeds] = s.[llp_checkedofcustomerneeds]
                , [llp_competitors] = s.[llp_competitors]
                , [llp_competitorsinsuraceother] = s.[llp_competitorsinsuraceother]
                , [llp_competitorsinsurance] = s.[llp_competitorsinsurance]
                , [llp_competitorsinsuranceselection] = s.[llp_competitorsinsuranceselection]
                , [llp_competitorsleasingother] = s.[llp_competitorsleasingother]
                , [llp_competitorsselection] = s.[llp_competitorsselection]
                , [llp_contractlenght] = s.[llp_contractlenght]
                , [llp_contractlengthmonth] = s.[llp_contractlengthmonth]
                , [llp_contractsigned] = s.[llp_contractsigned]
                , [llp_contractsignedby] = s.[llp_contractsignedby]
                , [llp_contractsignedby_entitytype] = s.[llp_contractsignedby_entitytype]
                , [llp_contractsignedbyname] = s.[llp_contractsignedbyname]
                , [llp_contractsignedbyon] = s.[llp_contractsignedbyon]
                , [llp_contractsignedbyyominame] = s.[llp_contractsignedbyyominame]
                , [llp_contracttype] = s.[llp_contracttype]
                , [llp_countofofferedtrucks] = s.[llp_countofofferedtrucks]
                , [llp_countofofferedtrucks_date] = s.[llp_countofofferedtrucks_date]
                , [llp_countofofferedtrucks_state] = s.[llp_countofofferedtrucks_state]
                , [llp_countrieswerefilled] = s.[llp_countrieswerefilled]
                , [llp_createdonreport] = s.[llp_createdonreport]
                , [llp_createsportoffer] = s.[llp_createsportoffer]
                , [llp_creditapplicationapproved] = s.[llp_creditapplicationapproved]
                , [llp_creditapplicationcreated] = s.[llp_creditapplicationcreated]
                , [llp_creditprecheckdone] = s.[llp_creditprecheckdone]
                , [llp_currency] = s.[llp_currency]
                , [llp_currency_base] = s.[llp_currency_base]
                , [llp_currentfleetmileage] = s.[llp_currentfleetmileage]
                , [llp_currentfleetmileagekmyear] = s.[llp_currentfleetmileagekmyear]
                , [llp_customeracceptedtheoffer] = s.[llp_customeracceptedtheoffer]
                , [llp_customerbillingaddress] = s.[llp_customerbillingaddress]
                , [llp_customeremail] = s.[llp_customeremail]
                , [llp_customername] = s.[llp_customername]
                , [llp_customerphone] = s.[llp_customerphone]
                , [llp_customerswerefilled] = s.[llp_customerswerefilled]
                , [llp_deliverycompleted] = s.[llp_deliverycompleted]
                , [llp_deliverydate] = s.[llp_deliverydate]
                , [llp_dout] = s.[llp_dout]
                , [llp_downpayment] = s.[llp_downpayment]
                , [llp_dppercent] = s.[llp_dppercent]
                , [llp_estimatedbodybuildingcompletiondate] = s.[llp_estimatedbodybuildingcompletiondate]
                , [llp_estimateddeliverydate] = s.[llp_estimateddeliverydate]
                , [llp_estimatedorderdate] = s.[llp_estimatedorderdate]
                , [llp_externalfinancing] = s.[llp_externalfinancing]
                , [llp_financing2] = s.[llp_financing2]
                , [llp_financingapproved] = s.[llp_financingapproved]
                , [llp_financingconfirmed] = s.[llp_financingconfirmed]
                , [llp_financinghidden] = s.[llp_financinghidden]
                , [llp_financingnoreasonother] = s.[llp_financingnoreasonother]
                , [llp_financingnothereason] = s.[llp_financingnothereason]
                , [llp_financingopportunitycreated] = s.[llp_financingopportunitycreated]
                , [llp_gdprcheck] = s.[llp_gdprcheck]
                , [llp_htmlspread] = s.[llp_htmlspread]
                , [llp_indicativeofferaccepted] = s.[llp_indicativeofferaccepted]
                , [llp_indicativeofferwassaved] = s.[llp_indicativeofferwassaved]
                , [llp_informationdirectlyfromcustomer] = s.[llp_informationdirectlyfromcustomer]
                , [llp_informationfromjusticecz] = s.[llp_informationfromjusticecz]
                , [llp_insurance2] = s.[llp_insurance2]
                , [llp_insurancehidden] = s.[llp_insurancehidden]
                , [llp_insuranceprice] = s.[llp_insuranceprice]
                , [llp_insuranceprice_base] = s.[llp_insuranceprice_base]
                , [llp_insuranceproductsselection] = s.[llp_insuranceproductsselection]
                , [llp_insuranceproductswereselected] = s.[llp_insuranceproductswereselected]
                , [llp_insurenceoffersend] = s.[llp_insurenceoffersend]
                , [llp_insurersselection] = s.[llp_insurersselection]
                , [llp_insurerswereselected] = s.[llp_insurerswereselected]
                , [llp_integrationsportguid] = s.[llp_integrationsportguid]
                , [llp_km] = s.[llp_km]
                , [llp_knownrivaloffer] = s.[llp_knownrivaloffer]
                , [llp_leasingasset] = s.[llp_leasingasset]
                , [llp_lockguid] = s.[llp_lockguid]
                , [llp_lossratiopercent] = s.[llp_lossratiopercent]
                , [llp_margin] = s.[llp_margin]
                , [llp_maxage] = s.[llp_maxage]
                , [llp_maxmileage] = s.[llp_maxmileage]
                , [llp_maxprice] = s.[llp_maxprice]
                , [llp_maxprice_base] = s.[llp_maxprice_base]
                , [llp_meetingwithbodybuilder] = s.[llp_meetingwithbodybuilder]
                , [llp_netsuitechange] = s.[llp_netsuitechange]
                , [llp_newpurchasemileagekmyear] = s.[llp_newpurchasemileagekmyear]
                , [llp_newpurchusemileage] = s.[llp_newpurchusemileage]
                , [llp_notifydrivecoach] = s.[llp_notifydrivecoach]
                , [llp_numberofitemsofobjectspecification] = s.[llp_numberofitemsofobjectspecification]
                , [llp_numberofitemsofobjectspecification_date] = s.[llp_numberofitemsofobjectspecification_date]
                , [llp_numberofitemsofobjectspecification_state] = s.[llp_numberofitemsofobjectspecification_state]
                , [llp_numberoftrucks] = s.[llp_numberoftrucks]
                , [llp_numberoftrucksinfleet] = s.[llp_numberoftrucksinfleet]
                , [llp_objectspecificationcompleted] = s.[llp_objectspecificationcompleted]
                , [llp_offeraccepted] = s.[llp_offeraccepted]
                , [llp_offeracceptedbycustomer] = s.[llp_offeracceptedbycustomer]
                , [llp_opportunitycountries_count] = s.[llp_opportunitycountries_count]
                , [llp_opportunitycountries_weightsum] = s.[llp_opportunitycountries_weightsum]
                , [llp_opportunitycustomer_count] = s.[llp_opportunitycustomer_count]
                , [llp_opportunitycustomer_weightsum] = s.[llp_opportunitycustomer_weightsum]
                , [llp_opportunityforfinancingwaslost] = s.[llp_opportunityforfinancingwaslost]
                , [llp_opportunitynumber] = s.[llp_opportunitynumber]
                , [llp_opportunitypreferableinsurer_count] = s.[llp_opportunitypreferableinsurer_count]
                , [llp_opportunitytype] = s.[llp_opportunitytype]
                , [llp_opportunitytypeofinsurance_count] = s.[llp_opportunitytypeofinsurance_count]
                , [llp_parentalbuid] = s.[llp_parentalbuid]
                , [llp_parentalbuid_entitytype] = s.[llp_parentalbuid_entitytype]
                , [llp_parentalbuidname] = s.[llp_parentalbuidname]
                , [llp_pdicomplete] = s.[llp_pdicomplete]
                , [llp_peakinlastyear] = s.[llp_peakinlastyear]
                , [llp_preferableinsurerid] = s.[llp_preferableinsurerid]
                , [llp_preferableinsurerid_entitytype] = s.[llp_preferableinsurerid_entitytype]
                , [llp_preferableinsureridname] = s.[llp_preferableinsureridname]
                , [llp_preferedfinancialproduct] = s.[llp_preferedfinancialproduct]
                , [llp_primaryquoteid] = s.[llp_primaryquoteid]
                , [llp_primaryquoteid_entitytype] = s.[llp_primaryquoteid_entitytype]
                , [llp_primaryquoteidname] = s.[llp_primaryquoteidname]
                , [llp_proposalsentdate] = s.[llp_proposalsentdate]
                , [llp_proposedprice] = s.[llp_proposedprice]
                , [llp_proposedprice_base] = s.[llp_proposedprice_base]
                , [llp_recordapproved] = s.[llp_recordapproved]
                , [llp_regno] = s.[llp_regno]
                , [llp_remark] = s.[llp_remark]
                , [llp_reservevehicle] = s.[llp_reservevehicle]
                , [llp_service] = s.[llp_service]
                , [llp_servicesactivated] = s.[llp_servicesactivated]
                , [llp_sfcategory] = s.[llp_sfcategory]
                , [llp_sourceopportunityid] = s.[llp_sourceopportunityid]
                , [llp_sourceopportunityid_entitytype] = s.[llp_sourceopportunityid_entitytype]
                , [llp_sourceopportunityidname] = s.[llp_sourceopportunityidname]
                , [llp_spreadapplicationapproved] = s.[llp_spreadapplicationapproved]
                , [llp_spreadapplicationmarginreason] = s.[llp_spreadapplicationmarginreason]
                , [llp_subjecttbfinanced] = s.[llp_subjecttbfinanced]
                , [llp_tradein] = s.[llp_tradein]
                , [llp_tradeinrequestcompleted] = s.[llp_tradeinrequestcompleted]
                , [llp_trucktype] = s.[llp_trucktype]
                , [llp_typeofinsuranceproduct] = s.[llp_typeofinsuranceproduct]
                , [llp_typeoftransport] = s.[llp_typeoftransport]
                , [llp_typeoftransportselection] = s.[llp_typeoftransportselection]
                , [llp_urljusticecz] = s.[llp_urljusticecz]
                , [llp_utreservationapprovalrequired] = s.[llp_utreservationapprovalrequired]
                , [llp_utreservationapproverhiddenid] = s.[llp_utreservationapproverhiddenid]
                , [llp_utreservationapproverhiddenid_entitytype] = s.[llp_utreservationapproverhiddenid_entitytype]
                , [llp_utreservationapproverhiddenidname] = s.[llp_utreservationapproverhiddenidname]
                , [llp_utreservationapproverhiddenidyominame] = s.[llp_utreservationapproverhiddenidyominame]
                , [llp_utsalespersonid] = s.[llp_utsalespersonid]
                , [llp_utsalespersonid_entitytype] = s.[llp_utsalespersonid_entitytype]
                , [llp_utsalespersonidname] = s.[llp_utsalespersonidname]
                , [llp_utsalespersonidyominame] = s.[llp_utsalespersonidyominame]
                , [llp_vehicleid] = s.[llp_vehicleid]
                , [llp_vehicleid_entitytype] = s.[llp_vehicleid_entitytype]
                , [llp_vehicleidname] = s.[llp_vehicleidname]
                , [llp_vehicleprice] = s.[llp_vehicleprice]
                , [llp_vehicleprice_base] = s.[llp_vehicleprice_base]
                , [llp_vehicleregistrationnumber] = s.[llp_vehicleregistrationnumber]
                , [llp_vin] = s.[llp_vin]
                , [llp_virtualaccount] = s.[llp_virtualaccount]
                , [llp_weightsumcountriesissue] = s.[llp_weightsumcountriesissue]
                , [llp_weightsumcustomersissue] = s.[llp_weightsumcustomersissue]
                , [modifiedby] = s.[modifiedby]
                , [modifiedby_entitytype] = s.[modifiedby_entitytype]
                , [modifiedbyname] = s.[modifiedbyname]
                , [modifiedbyyominame] = s.[modifiedbyyominame]
                , [modifiedon] = s.[modifiedon]
                , [modifiedonbehalfby] = s.[modifiedonbehalfby]
                , [modifiedonbehalfby_entitytype] = s.[modifiedonbehalfby_entitytype]
                , [modifiedonbehalfbyname] = s.[modifiedonbehalfbyname]
                , [modifiedonbehalfbyyominame] = s.[modifiedonbehalfbyyominame]
                , [msdyn_forecastcategory] = s.[msdyn_forecastcategory]
                , [name] = s.[name]
                , [need] = s.[need]
                , [onholdtime] = s.[onholdtime]
                , [opportunityid] = s.[opportunityid]
                , [opportunityratingcode] = s.[opportunityratingcode]
                , [originatingleadid] = s.[originatingleadid]
                , [originatingleadid_entitytype] = s.[originatingleadid_entitytype]
                , [originatingleadidname] = s.[originatingleadidname]
                , [originatingleadidyominame] = s.[originatingleadidyominame]
                , [overriddencreatedon] = s.[overriddencreatedon]
                , [ownerid] = s.[ownerid]
                , [ownerid_entitytype] = s.[ownerid_entitytype]
                , [owneridname] = s.[owneridname]
                , [owneridtype] = s.[owneridtype]
                , [owneridyominame] = s.[owneridyominame]
                , [owningbusinessunit] = s.[owningbusinessunit]
                , [owningbusinessunit_entitytype] = s.[owningbusinessunit_entitytype]
                , [owningteam] = s.[owningteam]
                , [owningteam_entitytype] = s.[owningteam_entitytype]
                , [owninguser] = s.[owninguser]
                , [owninguser_entitytype] = s.[owninguser_entitytype]
                , [parentaccountid] = s.[parentaccountid]
                , [parentaccountid_entitytype] = s.[parentaccountid_entitytype]
                , [parentaccountidname] = s.[parentaccountidname]
                , [parentaccountidyominame] = s.[parentaccountidyominame]
                , [parentcontactid] = s.[parentcontactid]
                , [parentcontactid_entitytype] = s.[parentcontactid_entitytype]
                , [parentcontactidname] = s.[parentcontactidname]
                , [parentcontactidyominame] = s.[parentcontactidyominame]
                , [participatesinworkflow] = s.[participatesinworkflow]
                , [presentfinalproposal] = s.[presentfinalproposal]
                , [presentproposal] = s.[presentproposal]
                , [pricelevelid] = s.[pricelevelid]
                , [pricelevelid_entitytype] = s.[pricelevelid_entitytype]
                , [pricelevelidname] = s.[pricelevelidname]
                , [pricingerrorcode] = s.[pricingerrorcode]
                , [prioritycode] = s.[prioritycode]
                , [processid] = s.[processid]
                , [proposedsolution] = s.[proposedsolution]
                , [purchaseprocess] = s.[purchaseprocess]
                , [purchasetimeframe] = s.[purchasetimeframe]
                , [pursuitdecision] = s.[pursuitdecision]
                , [qualificationcomments] = s.[qualificationcomments]
                , [quotecomments] = s.[quotecomments]
                , [resolvefeedback] = s.[resolvefeedback]
                , [salesstage] = s.[salesstage]
                , [salesstagecode] = s.[salesstagecode]
                , [schedulefollowup_prospect] = s.[schedulefollowup_prospect]
                , [schedulefollowup_qualify] = s.[schedulefollowup_qualify]
                , [scheduleproposalmeeting] = s.[scheduleproposalmeeting]
                , [sendthankyounote] = s.[sendthankyounote]
                , [SinkCreatedOn] = s.[SinkCreatedOn]
                , [SinkModifiedOn] = s.[SinkModifiedOn]
                , [slaid] = s.[slaid]
                , [slaid_entitytype] = s.[slaid_entitytype]
                , [slainvokedid] = s.[slainvokedid]
                , [slainvokedid_entitytype] = s.[slainvokedid_entitytype]
                , [slainvokedidname] = s.[slainvokedidname]
                , [slaname] = s.[slaname]
                , [stageid] = s.[stageid]
                , [statecode] = s.[statecode]
                , [statuscode] = s.[statuscode]
                , [stepid] = s.[stepid]
                , [stepname] = s.[stepname]
                , [teamsfollowed] = s.[teamsfollowed]
                , [timeline] = s.[timeline]
                , [timespentbymeonemailandmeetings] = s.[timespentbymeonemailandmeetings]
                , [timezoneruleversionnumber] = s.[timezoneruleversionnumber]
                , [totalamount] = s.[totalamount]
                , [totalamount_base] = s.[totalamount_base]
                , [totalamountlessfreight] = s.[totalamountlessfreight]
                , [totalamountlessfreight_base] = s.[totalamountlessfreight_base]
                , [totaldiscountamount] = s.[totaldiscountamount]
                , [totaldiscountamount_base] = s.[totaldiscountamount_base]
                , [totallineitemamount] = s.[totallineitemamount]
                , [totallineitemamount_base] = s.[totallineitemamount_base]
                , [totallineitemdiscountamount] = s.[totallineitemdiscountamount]
                , [totallineitemdiscountamount_base] = s.[totallineitemdiscountamount_base]
                , [totaltax] = s.[totaltax]
                , [totaltax_base] = s.[totaltax_base]
                , [transactioncurrencyid] = s.[transactioncurrencyid]
                , [transactioncurrencyid_entitytype] = s.[transactioncurrencyid_entitytype]
                , [transactioncurrencyidname] = s.[transactioncurrencyidname]
                , [traversedpath] = s.[traversedpath]
                , [utcconversiontimezonecode] = s.[utcconversiontimezonecode]
                , [versionnumber] = s.[versionnumber]
                , [wa_brandid] = s.[wa_brandid]
                , [wa_brandid_entitytype] = s.[wa_brandid_entitytype]
                , [wa_brandidname] = s.[wa_brandidname]
                , [wa_externalid] = s.[wa_externalid]
                , [wa_opportunitygroup] = s.[wa_opportunitygroup]
                , [wa_opportunitygroup_entitytype] = s.[wa_opportunitygroup_entitytype]
                , [wa_opportunitygroupname] = s.[wa_opportunitygroupname]
                , [wa_opportunitysourceid] = s.[wa_opportunitysourceid]
                , [wa_opportunitysourceid_entitytype] = s.[wa_opportunitysourceid_entitytype]
                , [wa_opportunitysourceidname] = s.[wa_opportunitysourceidname]
                , [wa_productid] = s.[wa_productid]
                , [wa_productid_entitytype] = s.[wa_productid_entitytype]
                , [wa_productidname] = s.[wa_productidname]
                , [DataSourceId] = @DataSourceId
                , [ThreadLogId] = @ThreadLogId
    
        FROM [scaniacrmexport.database.windows.net].[ScaniaCRMExport].[dbo].[opportunity] AS s WITH (NOLOCK)

        --Log ThreadLog Success
        UPDATE Etl.ThreadLog
        SET ExtractRowCount = (SELECT COUNT(*) FROM [Stage].[CRMdboOpportunity] WITH (NOLOCK) WHERE ThreadLogId = @ThreadLogId)
            , InsertRowCount = (SELECT COUNT(*) FROM [Stage].[CRMdboOpportunity] WITH (NOLOCK) WHERE ThreadLogId = @ThreadLogId)
            , TableFinalRowCount = (SELECT COUNT(*) FROM [Stage].[CRMdboOpportunity] WITH (NOLOCK) )
            , EndTime = GETDATE()
            , LoadDateFrom = @loadDateFrom
            , LoadDateTo = GETDATE()
            , StatusId = 3
        WHERE ThreadLogId = @ThreadLogId;

        END TRY

        BEGIN CATCH
            EXEC [dbo].[uspErrorHandler] @ThreadLogId = @ThreadLogId;
        END CATCH
            
        RETURN;
```

\[Back to stored procedure list\]\[listofprocedures\]
